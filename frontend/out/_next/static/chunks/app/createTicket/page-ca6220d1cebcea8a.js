(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[939],{2502:(e,t,s)=>{Promise.resolve().then(s.bind(s,8113))},5695:(e,t,s)=>{"use strict";var l=s(8999);s.o(l,"useRouter")&&s.d(t,{useRouter:function(){return l.useRouter}}),s.o(l,"useSearchParams")&&s.d(t,{useSearchParams:function(){return l.useSearchParams}})},8113:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i});var l=s(5155),n=s(5695),r=s(2115);function i(){let e=(0,n.useRouter)(),[t,s]=(0,r.useState)({state:!1,pending:!0}),[i,a]=(0,r.useState)(""),[c,d]=(0,r.useState)(""),[o,u]=(0,r.useState)({state:[],pending:!0}),[f,p]=(0,r.useState)([]);return((0,r.useEffect)(()=>{!async function(){s(e=>({...e,pending:!0}));let t=await fetch("".concat("http://localhost:8000/api","/session"),{method:"GET",cache:"no-cache",credentials:"include"});if(200==t.status){s(()=>({state:!0,pending:!1}));let{role:l,username:n}=await t.json();if(null!=n&&d(n),"admin"!=l){s(()=>({state:!1,pending:!1})),e.replace("/");return}let r=await fetch("".concat("http://localhost:8000/api","/users"),{method:"GET",cache:"no-cache",credentials:"include"});if(r.ok){let e=await r.json();u(()=>({state:e,pending:!1}))}}else{s(e=>({...e,pending:!1})),e.replace("/");}}()},[e]),!0==t.pending)?(0,l.jsx)("p",{className:"flex w-full h-full items-center justify-center text-center italic text-2xl",children:"Checking Credentials..."}):!1==t.pending&&!1==t.state?(0,l.jsx)("p",{className:"flex w-full h-full items-center justify-center text-center italic text-2xl",children:"Not Logged In... Not authorised, being redirected."}):(0,l.jsxs)("div",{className:"flex w-full h-full items-center justify-center flex-col gap-6",children:[(0,l.jsx)("h1",{className:"flex text-4xl underline pb-8",children:"Create A Ticket"}),(0,l.jsxs)("form",{action:function(e){!async function(){var t,s,l,n,r,i;if(null==e)return p([]);((null==(t=e.get("title"))?void 0:t.toString())==" "||(null==(s=e.get("description"))?void 0:s.toString())==" "||(null==(l=e.get("title"))?void 0:l.toString())==null||(null==(n=e.get("description"))?void 0:n.toString())==null||0==f.length)&&(p([]),a("Form Error. Please provide some content to the fields."));let d=o.state.find(e=>e.username===c),u=null==d?void 0:d.user_id,x={title:null==(r=e.get("title"))?void 0:r.toString(),description:null==(i=e.get("description"))?void 0:i.toString(),status:"Open",assigned_user_ids:Array.from(new Set([...f,u])).filter(Boolean)},h=await fetch("".concat("http://localhost:8000/api","/tickets"),{method:"POST",cache:"no-cache",credentials:"include",body:JSON.stringify(x),headers:{"Content-Type":"application/json"}}),m=await h.json();h.ok?a("Successfully created ticket!"):a("Server Response: ".concat(JSON.stringify(m))),p([])}()},className:"flex flex-col gap-4 w-[70%] h-fit",children:[(0,l.jsxs)("div",{className:"flex flex-row gap-4 items-center w-full",children:[(0,l.jsx)("label",{htmlFor:"title",className:"flex text-lg w-[20%]",children:"Title"}),(0,l.jsx)("input",{type:"text",name:"title",required:!0,className:"flex border-[1px] border-gray-600 rounded-sm shadow-md px-4 py-2 w-[80%]",placeholder:"Enter title..."})]}),(0,l.jsxs)("div",{className:"flex flex-row gap-4 items-center w-full",children:[(0,l.jsx)("label",{htmlFor:"title",className:"flex text-lg w-[20%]",children:"Description"}),(0,l.jsx)("textarea",{name:"description",rows:5,required:!0,className:"flex border-[1px] border-gray-600 rounded-sm shadow-md px-4 py-2 w-[80%]",placeholder:"Enter description..."})]}),(0,l.jsxs)("div",{className:"flex flex-row gap-4 w-full items-center",children:[(0,l.jsx)("label",{className:"flex text-lg w-[20%]",children:"Assign To"}),!1==o.pending?(0,l.jsx)("div",{className:"grid grid-cols-4 gap-2 w-[80%] overflow-y-auto border border-gray-300 rounded p-2 items-center justify-center",children:o.state.filter(e=>e.username!==c).map(e=>(0,l.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,l.jsx)("input",{type:"checkbox",value:e.user_id,checked:f.includes(e.user_id),onChange:e=>{let t=parseInt(e.target.value);p(s=>e.target.checked?[...s,t]:s.filter(e=>e!==t))}}),e.username]},e.user_id))}):(0,l.jsx)("p",{className:"flex w-[80%] text-md italic items-center",children:"Loading users..."})]}),(0,l.jsx)("button",{type:"submit",className:"flex px-4 py-2 border-[1px] border-gray-500 rounded-sm shadow-md bg-blue-200 hover:bg-blue-400 hover:underline text-center items-center justify-center w-[30%] self-end",children:"Submit"}),(0,l.jsx)("p",{className:"flex italic text-sm self-end p-2",children:i})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[441,684,358],()=>t(2502)),_N_E=e.O()}]);