(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[903],{1469:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var s in t)Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}(t,{default:function(){return i},getImageProps:function(){return r}});let a=s(8229),n=s(8883),l=s(3063),c=a._(s(1193));function r(e){let{props:t}=(0,n.getImgProps)(e,{defaultLoader:c.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!1}});for(let[e,s]of Object.entries(t))void 0===s&&delete t[e];return{props:t}}let i=l.Image},5672:(e,t,s)=>{Promise.resolve().then(s.bind(s,6894))},5695:(e,t,s)=>{"use strict";var a=s(8999);s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},6766:(e,t,s)=>{"use strict";s.d(t,{default:()=>n.a});var a=s(1469),n=s.n(a)},6894:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var a=s(5155),n=s(2115),l=s(5695);let c={src:"/_next/static/media/delete.7132e487.svg",height:24,width:24,blurWidth:0,blurHeight:0};var r=s(6766);function i(){let e=(0,l.useSearchParams)(),t=(0,l.useRouter)(),[s,i]=(0,n.useState)(!1),[o,d]=(0,n.useState)(null),[u,h]=(0,n.useState)({state:[],pending:!0}),[f,x]=(0,n.useState)({state:!1,pending:!0}),[m,p]=(0,n.useState)(""),[g,j]=(0,n.useState)(0),[w,b]=(0,n.useState)(!1),[N,y]=(0,n.useState)({state:null,pending:!0});function v(e){let{data:t}=e;return null==N.state?null:(0,a.jsxs)("div",{className:"flex w-full h-fit flex-row border-[1px] border-gray-300 rounded-sm shadow-sm px-4 py-2 items-center",children:[(0,a.jsxs)("div",{className:"flex w-[95%] h-fit flex-col gap-2 items-center",children:[(0,a.jsx)("p",{className:"flex text-md self-start",children:t.content}),(0,a.jsx)("span",{className:"flex h-[1px] w-[90%] bg-gray-300"}),(0,a.jsxs)("div",{className:"flex w-full h-fit flex-row justify-around",children:[(0,a.jsxs)("h4",{className:"flex",children:["Author: ",t.author_username]}),(0,a.jsxs)("h4",{className:"flex",children:["Date Written: ",t.created_at]})]})]}),g==N.state.creator_id||m===t.author_username?(0,a.jsx)("button",{className:"flex w-[5%] h-full flex-col items-center justify-center bg-red-300 rounded-md shadow-md hover:bg-red-500 hover:cursor-pointer",onClick:()=>{fetch("".concat("http://localhost:8000/api","/comments/").concat(t.id),{method:"DELETE",cache:"default",credentials:"include"}),i(e=>!e)},children:(0,a.jsx)(r.default,{src:c,alt:"Delete Icon"})}):null]})}function S(e){!async function(){await fetch("".concat("http://localhost:8000/api","/tickets/").concat(o),{method:"PATCH",credentials:"include",cache:"no-cache",body:JSON.stringify({status:e}),headers:{"Content-Type":"application/json"}}),i(e=>!e)}()}return(0,n.useEffect)(()=>{!async function(){x(e=>({...e,pending:!0})),y(e=>({...e,pending:!0})),h(e=>({...e,pending:!0}));let s=e.get("id");if(!s)return t.replace("/");d(()=>Number(s));let a=await fetch("".concat("http://localhost:8000/api","/session"),{method:"GET",cache:"no-cache",credentials:"include"});if(200!=a.status){x(()=>({state:!1,pending:!1})),t.replace("/");return}x(()=>({state:!0,pending:!1}));let{role:n,username:l,user_id:c}=await a.json();"admin"==n&&b(()=>!0),null!=l&&p(l),0!=c&&null!=c&&j(c);let r=await fetch("".concat("http://localhost:8000/api","/tickets/").concat(s),{method:"GET",cache:"no-cache",credentials:"include"});if(!r.ok)return t.replace("/");let i=await r.json();y(()=>({state:i,pending:!1}));let o=await fetch("".concat("http://localhost:8000/api","/tickets/").concat(s,"/comments"),{method:"GET",cache:"no-cache",credentials:"include"}),u=await o.json(),f=[];for(let e=0;e<u.length;e++){let t=u[e],s=await fetch("".concat("http://localhost:8000/api","/users/").concat(t.author_id),{method:"GET",cache:"force-cache",credentials:"include"}),a=(await s.json()).username;f.push({...t,author_username:a})}h(()=>({state:f,pending:!1}))}()},[s,t,e]),!0==f.pending?(0,a.jsx)("p",{className:"flex w-full h-full items-center justify-center text-center italic text-2xl",children:"Checking Credentials..."}):!1==f.pending&&!1==f.state?(0,a.jsx)("p",{className:"flex w-full h-full items-center justify-center text-center italic text-2xl",children:"Not Logged In... Not authorised, being redirected."}):!0==N.pending||null==N.state?(0,a.jsx)("p",{className:"flex w-full h-full items-center justify-center text-center italic text-2xl",children:"Loading ticket data..."}):!0==u.pending?(0,a.jsx)("p",{className:"flex w-full h-full items-center justify-center text-center italic text-2xl",children:"Loading comments data..."}):(0,a.jsxs)("div",{className:"flex w-full h-full flex-col gap-4 justify-center items-center px-24",children:[!0==w&&(0,a.jsx)("h4",{className:"flex text-sm italic text-green-800",children:"Logged in as Admin"}),(0,a.jsx)("h1",{className:"flex text-4xl underline bold",children:N.state.title}),(0,a.jsx)("p",{className:"flex text-lg",children:N.state.description}),(0,a.jsx)("span",{className:"flex h-[1px] w-full bg-gray-300"}),(0,a.jsxs)("div",{className:"flex w-full h-fit flex-row gap-4 justify-center items-center",children:[(0,a.jsx)("h5",{className:"flex text-md",children:"Current Status:"}),(0,a.jsx)(function(){if(null!=N.state){if(null!=N.state.status)return(0,a.jsx)(a.Fragment,{children:"open"===N.state.status.toLowerCase()?(0,a.jsx)("h4",{className:"flex px-4 py-2 rounded-sm shadow-sm bg-green-300",children:N.state.status.toUpperCase()}):"closed"===N.state.status.toLowerCase()?(0,a.jsx)("h4",{className:"flex px-4 py-2 rounded-sm shadow-sm bg-red-300",children:N.state.status.toUpperCase()}):"in review"===N.state.status.toLowerCase()?(0,a.jsx)("h4",{className:"flex px-4 py-2 rounded-sm shadow-sm bg-orange-300",children:N.state.status.toUpperCase()}):null})}},{}),g==N.state.creator_id&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"flex h-full w-[1px] bg-gray-300"}),(0,a.jsx)("h5",{className:"flex text-md",children:"Change Status:"}),(0,a.jsx)("button",{className:"flex px-4 py-2 bg-green-300 rounded-md shadow-md hover:bg-green-600 hover:underline",onClick:()=>{S("Open")},children:"OPEN"}),(0,a.jsx)("button",{className:"flex px-4 py-2 bg-orange-300 rounded-md shadow-md hover:bg-orange-600 hover:underline",onClick:()=>{S("In Review")},children:"PUT INTO REVIEW"}),(0,a.jsx)("button",{className:"flex px-4 py-2 bg-red-300 rounded-md shadow-md hover:bg-red-600 hover:underline",onClick:()=>{S("Closed")},children:"CLOSE"})]})]}),(0,a.jsx)("span",{className:"flex h-[1px] w-full bg-gray-300"}),(0,a.jsx)("h2",{className:"flex text-2xl self-start",children:"Comments:"}),(0,a.jsx)(function(){return(0,a.jsxs)("form",{action:function(e){!async function(){var t;if(null==FormData)return;let s=null==(t=e.get("content"))?void 0:t.toString();await fetch("".concat("http://localhost:8000/api","/tickets/").concat(o,"/comments"),{method:"POST",credentials:"include",cache:"no-cache",body:JSON.stringify({content:s}),headers:{"Content-Type":"application/json"}}),i(e=>!e)}()},className:"flex flex-row gap-2 w-full h-fit border-[1px] border-gray-200 shadow-md rounded-sm p-2",children:[(0,a.jsx)("input",{type:"text",name:"content",placeholder:"Write a comment",className:"flex italic w-[80%] bg-gray-100 rounded-md p-2"}),(0,a.jsx)("button",{className:"flex w-[20%] px-4 py-2 bg-blue-200 hover:bg-blue-400 hover:underline items-center justify-center shadow-md rounded-md",children:"POST"})]})},{}),(0,a.jsx)("div",{className:"flex w-full h-fit gap-4 flex-col",children:u.state.map(e=>(0,a.jsx)(v,{data:e},e.id))})]})}function o(){return(0,a.jsx)(n.Suspense,{fallback:(0,a.jsx)("p",{children:"Loading search params..."}),children:(0,a.jsx)(i,{})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[63,441,684,358],()=>t(5672)),_N_E=e.O()}]);